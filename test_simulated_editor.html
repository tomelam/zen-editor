<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strictexmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Simulated Editor</title>
    
    <style type="text/css">
      @import "dojo/dijit/themes/claro/document.css";
      @import "dojo/dijit/tests/css/dijitTests.css";
      @import "dojo/dijit/themes/claro/claro.css";
      @import "dojo/dojox/mobile/themes/common/dijit/dijit.css";
    </style>
    
    <style type="text/css">
      form { margin-bottom : 0; }
      table { border: none; }
      #dyn_dialog_underlay { background-color: #027 }
    </style>
    
    <script type="text/javascript" src="dojo/dojo/dojo.js"></script>
    
    <script type="text/javascript">
      require([
	"dojo/_base/lang",
	"dojo/date/stamp",
	"dojo/dom",
	
	"dijit/registry",
	"dijit/Dialog",
	"dijit/form/Button",
	
	"dojo/dom-construct",
	"dojo/on",
	
	// used by parser
	"dijit/Editor",
	"dijit/_editor/plugins/AlwaysShowToolbar",
	"dijit/InlineEditBox",
	"dijit/Menu",
	"dijit/MenuItem",
	"dijit/MenuSeparator",
	"dijit/form/TextBox",
	"dijit/form/DateTextBox",
	"dijit/form/TimeTextBox",
	"dijit/form/FilteringSelect",
	"dijit/layout/BorderContainer",
	"dijit/layout/ContentPane",
	"dijit/layout/TabContainer",
	
	"dojo/domReady!"
    ], function(lang, stamp, dom, registry, Dialog, Button, domConstruct, on){
	var dynDialog, editor, acceptButton, closeButton;
	
	createDialog = function() {
	    if (!(dynDialog = dijit.byId("dynDialog"))) {
		var tree, html = '<div id="editorDialog" style="display: none;">';
		html += '<textarea id="dialogTextarea" style="width: 90%" placeholder="enter text here"></textarea>';
		html += '<br><div id="editButton"></div><div id="editCloseButton"></div>';
		tree = domConstruct.toDom(html);
		domConstruct.place(tree, "editorDialogContainer");
		
		console.info("creating dialog");
		var pane = dom.byId('editorDialog');
		// should specify a width on dialogs with <p> tags, otherwise they get too wide
		dynDialog = new dijit.Dialog({
		    id: "dynDialog",
		    title: "Edit Attribute",
		    style: {width: '300px'}
		},pane);
		
		acceptButton = new Button({
		    label: "Accept",
		    onClick: function(){
			editor = dom.byId("editor");
			newVal = dom.byId("dialogTextarea").value;
			console.log("focusing editor and setting value to " + newVal);
			editor.focus();
			editor.value = newVal;
		    }
		}, "editButton").startup();
		
		closeButton = new Button({
		    label: "Close",
		    onClick: function(){
			dynDialog.hide();
		    }
		}, "editCloseButton").startup();

		dynDialog = dijit.byId("dynDialog"), acceptButton = dijit.byId("editButton"), closeButton = dijit.byId("editCloseButton");
		console.log("dynDialog => " + dynDialog + ", acceptButton => " + acceptButton + ", closeButton => " + closeButton);

	    }
	};
	
	destroyDialog = function() {
	    dynDialog = dijit.byId("dynDialog"), acceptButton = dijit.byId("editButton"), closeButton = dijit.byId("editCloseButton");
	    console.info("destroying dialog");
	    console.log("acceptButton => " + acceptButton + ", closeButton => " + closeButton);
	    acceptButton.destroy();
	    console.log("Destroyed acceptButton? " + dijit.byId("editButton"));
	    closeButton.destroy();
	    console.log("Destroyed closeButton? " + dijit.byId("closeButton"));
	    console.log("dynDialog => " + dynDialog);
	    dynDialog.destroy();
	    console.log("Destroyed dynDialog? " + dijit.byId("dynDialog"));
	};
	
	showDialog = function(){
	    editor = dom.byId("editor");
	    dom.byId("dialogTextarea").value = editor.value;
	    dynDialog.show();
	};
	
    });
    
    </script>
  </head>
  <body class="claro" role="main">
    
    <h2>Simulated Editor with Dialog</h2>
    
    <button onclick="createDialog();">Create Editor's HTML</button>
    <button onclick="destroyDialog();">Remove Editor's HTML</button>
    <button onclick="showDialog();">Edit</button>
    <br />
    
    <div id="editorDialogContainer"></div>
    
    <textarea id="editor" style="width: 90%; border: solid gray 1px;">initial value</textarea>
    
  </body>
</html>
